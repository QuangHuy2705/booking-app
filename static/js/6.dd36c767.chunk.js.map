{"version":3,"sources":["commons/router/asyncRoute.js","components/homepage/index.js"],"names":["moduleDefaultExport","module","default","esModule","forceArray","isArray","map","defualted","asyncRoute","getComponent","getReducers","getEpics","_class","_temp","_Component","AsyncRoute","_getPrototypeOf2","_this","Object","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","_len","arguments","length","args","Array","_key","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","apply","concat","state","Component","ReducersLoaded","EpicsLoaded","error","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__","key","value","_this2","_this$state","shouldLoadReducers","shouldLoadEpics","_this$context","context","registerEpics","registerReducers","_componentWillUnmountSubject","Subject","streams","Observable","of","takeUntil","fromPromise","console","log","push","reducers","epics","zip","subscribe","_ref","AsyncComponent","D_soure_code_booking_app_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","setState","unsubscribe","_mounted","closed","next","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","props","contextTypes","store","PropTypes","object","isRequired","func","__webpack_require__","r","__webpack_exports__","_commons_router_asyncRoute__WEBPACK_IMPORTED_MODULE_0__","e","then","bind"],"mappings":"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","file":"static/js/6.dd36c767.chunk.js","sourcesContent":["import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { isArray } from 'lodash'\r\nimport { Observable } from 'rxjs/Observable'\r\nimport { Subject } from 'rxjs/Subject'\r\nimport 'rxjs/add/operator/map'\r\nimport 'rxjs/add/operator/takeUntil'\r\nimport 'rxjs/add/observable/zip'\r\nimport 'rxjs/add/observable/of'\r\nimport { fromPromise } from 'rxjs/observable/fromPromise'\r\n\r\n\r\nconst moduleDefaultExport = module => module.default || module\r\n\r\nfunction esModule(module, forceArray) {\r\n  if (isArray(module)) {\r\n    return module.map(moduleDefaultExport)\r\n  }\r\n\r\n  const defualted = moduleDefaultExport(module)\r\n  return forceArray ? [defualted] : defualted\r\n}\r\n\r\n\r\n\r\nexport default function asyncRoute(getComponent, getReducers, getEpics) {\r\n  return class AsyncRoute extends Component {\r\n    static contextTypes = {\r\n      store: PropTypes.object.isRequired,\r\n      registerEpics: PropTypes.func.isRequired,\r\n      registerReducers: PropTypes.func.isRequired,\r\n      // withRefreshedStore: PropTypes.func.isRequired,\r\n    }\r\n\r\n    static Component = null\r\n    static ReducersLoaded = false\r\n    static EpicsLoaded = false\r\n\r\n    state = {\r\n      Component: AsyncRoute.Component,\r\n      ReducersLoaded: AsyncRoute.ReducersLoaded,\r\n      EpicsLoaded: AsyncRoute.EpicsLoaded,\r\n      error: null\r\n    }\r\n\r\n    componentDidMount() {\r\n      const { Component, ReducersLoaded, EpicsLoaded } = this.state\r\n      const shouldLoadReducers = !ReducersLoaded && getReducers\r\n      const shouldLoadEpics = !EpicsLoaded && getEpics\r\n      const { registerEpics, registerReducers } = this.context\r\n\r\n      if (!Component || shouldLoadReducers || shouldLoadEpics) {\r\n        this._componentWillUnmountSubject = new Subject()\r\n        const streams = [\r\n          Component\r\n            ? Observable.of(Component)\r\n              .takeUntil(this._componentWillUnmountSubject)\r\n            : fromPromise(getComponent)\r\n              .map(esModule)\r\n              .map(Component => {\r\n                console.log(`LOADED`, Component)\r\n                AsyncRoute.Component = Component\r\n                return Component\r\n              })\r\n              .takeUntil(this._componentWillUnmountSubject)\r\n        ]\r\n\r\n        if (shouldLoadReducers) {\r\n          streams.push(\r\n            fromPromise(getReducers)\r\n              .map(module => esModule(module, true))\r\n              .map(reducers => {\r\n                console.log(`newReducers`, reducers)\r\n                registerReducers(reducers)\r\n                AsyncRoute.ReducersLoaded = true\r\n              })\r\n              .takeUntil(this._componentWillUnmountSubject)\r\n          )\r\n        }\r\n\r\n        if (shouldLoadEpics) {\r\n          streams.push(\r\n            fromPromise(getEpics)\r\n              .map(epics => {\r\n                console.log(`NEW EPICS`, epics)\r\n                registerEpics(epics)\r\n                AsyncRoute.EpicsLoaded = true\r\n              })\r\n              .takeUntil(this._componentWillUnmountSubject)\r\n          )\r\n        }\r\n        Observable.zip(...streams)\r\n          .takeUntil(this._componentWillUnmountSubject)\r\n          .subscribe(\r\n            ([AsyncComponent]) => {\r\n              this.setState({ Component: AsyncComponent })\r\n              this._componentWillUnmountSubject.unsubscribe()\r\n            },\r\n            error => {\r\n              console.log(error)\r\n              this.setState({ error })\r\n            },\r\n          )\r\n      }\r\n      this._mounted = true\r\n    }\r\n\r\n\r\n    componentWillUnmount() {\r\n      if (this._componentWillUnmountSubject && !this._componentWillUnmountSubject.closed) {\r\n        this._componentWillUnmountSubject.next()\r\n        this._componentWillUnmountSubject.unsubscribe()\r\n      }\r\n    }\r\n\r\n    render() {\r\n      const { Component } = this.state\r\n      return Component ? <Component {...this.props} /> : null\r\n    }\r\n  }\r\n}","import asyncRoute from '../../commons/router/asyncRoute'\r\n\r\nexport default asyncRoute(\r\n    import('./homepage.container'),\r\n    // import('./homepage.reducers'),\r\n    // import('./homepage.epics')\r\n)"],"sourceRoot":""}